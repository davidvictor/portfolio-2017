import React, {Component} from 'react';
import {Link, NavLink} from 'react-router-dom';
import IconButtons from './iconButtons';
import Headroom from 'react-headroom';
import BodyClass from 'react-body-classname';
import Menu from '../menu';
import {Flex, Box} from 'reflexbox';
import classNames from 'classnames';
import style from './style.scss';
import K from '../kaleidoscope';
import ReactGA from 'react-ga';
import {assetUrl} from 'config';
import {compose, withState, withHandlers} from 'recompose';

const withActive = compose(
	withState('active', 'setActive', false),
	withHandlers({
		on:     props => () => props.setActive(true),
		off:    props => () => props.setActive(false),
		toggle: props => () => props.setActive(a => !a),
	})
);

const Header = ({off}) => {
	const classes      = classNames("header", style.header);
	const handleToggle = () => {
		off();
		ReactGA.event({
			category: 'Navigation',
			action:   'Clicked Site Logo'
		});
	};
	return (
		<div className={classes}>
			<Flex justify='flex-start' wrap={false}>
				<Box col={12}>
					<Link to="/" className={style.logoLink} onClick={() => handleToggle()}>
						<span className={style.logo}>
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 91 10">
  <path fill="#221F20" fillRule="evenodd" d="M5.854.744c-.48 0-1.368.012-2.028.012-.708 0-1.92-.024-2.04-.024l-.084.564h.816c.468 0 .576.12.54.588-.048.468-.912 5.604-1.02 6.06-.108.408-.228.48-.78.48H.55l-.072.6C.622 9.012 1.942 9 2.446 9c.516 0 1.884.012 2.04.012 2.544 0 4.524-1.044 4.98-3.972C9.922 2.016 8.698.744 5.854.744zM3.202 7.896c.06-.588.912-5.748 1.008-6.108.108-.372.276-.552.66-.552h.78c2.34 0 3.084.912 2.604 3.78-.468 2.76-1.764 3.48-3.828 3.48H3.73c-.432 0-.576-.144-.528-.6zm12.432-1.56l.18 1.032c.132.744-.036 1.056-.744 1.056h-.528l-.084.6S15.766 9 16.486 9c.732 0 2.028.024 2.028.024l.072-.6h-.54c-.624 0-.78-.216-.948-.936-.396-1.632-1.14-5.184-1.452-6.816 0 0-.324.012-.504.012s-.504-.012-.516-.012c-.54 1.08-3.144 5.736-3.744 6.804-.42.756-.72.948-1.416.948h-.42l-.072.6S10.138 9 10.774 9c.648 0 1.8.024 1.8.024l.072-.6h-.552c-.792 0-.852-.372-.516-1.032.096-.204.3-.588.564-1.056.912-.024 2.544-.024 3.492 0zm-3.216-.504c.78-1.428 1.836-3.312 2.28-4.14.24 1.056.588 2.748.84 4.14-.888.012-2.244.012-3.12 0zm8.472-3.624c-.108-.684.132-.912.708-.912h.528l.048-.564c-.18 0-1.176.024-1.848.024-.672 0-1.86-.024-1.86-.024l-.06.564h.36c.636 0 .792.216.924.828.384 1.656 1.068 5.28 1.38 6.948.18-.012.696-.012.888 0 .828-1.632 2.676-5.136 3.552-6.78.444-.816.696-.996 1.356-.996h.372l.06-.564c-.192 0-1.02.024-1.596.024-.588 0-1.608-.024-1.608-.024l-.06.564h.432c.696 0 .816.264.456.996-.636 1.344-2.04 4.056-2.928 5.736-.336-1.608-.888-4.452-1.104-5.82zm5.748 6.816S27.91 9 28.618 9s1.98.024 1.98.024l.06-.6h-.732c-.552 0-.648-.072-.612-.48.036-.408.912-5.58 1.044-6.048.12-.468.288-.6.72-.6h.804l.06-.564c-.192 0-1.26.024-1.98.024-.708 0-1.98-.024-1.98-.024l-.072.564h.804c.432 0 .564.132.528.6-.036.468-.924 5.64-1.044 6.048-.108.42-.24.48-.792.48h-.708l-.06.6zM36.862.744c-.48 0-1.368.012-2.028.012-.708 0-1.92-.024-2.04-.024l-.084.564h.816c.468 0 .576.12.54.588-.048.468-.912 5.604-1.02 6.06-.108.408-.228.48-.78.48h-.708l-.072.6C31.63 9.012 32.95 9 33.454 9c.516 0 1.884.012 2.04.012 2.544 0 4.524-1.044 4.98-3.972.456-3.024-.768-4.296-3.612-4.296zM34.21 7.896c.06-.588.912-5.748 1.008-6.108.108-.372.276-.552.66-.552h.78c2.34 0 3.084.912 2.604 3.78-.468 2.76-1.764 3.48-3.828 3.48h-.696c-.432 0-.576-.144-.528-.6zm11.28-5.004c-.096-.732.144-1.032.612-1.032h.348c.012-.192.12-.948.168-1.128-.192 0-1.488.024-2.328.024-.84 0-2.34-.024-2.34-.024-.012.18-.12.936-.156 1.128h.252c.672 0 .864.276.996.9.336 1.5.888 4.8 1.128 6.312.54-.024 1.716-.024 2.256 0 .66-1.5 2.172-4.74 2.928-6.252.384-.78.72-.96 1.356-.96h.324c.012-.192.12-.948.156-1.128-.192 0-1.14.024-1.788.024-.648 0-1.788-.024-1.788-.024-.024.18-.12.936-.168 1.128h.3c.576 0 .636.36.36 1.044-.384.972-1.284 2.892-1.872 4.104-.24-1.176-.612-3.144-.744-4.116zm4.98 6.132S51.886 9 52.678 9c.792 0 2.208.024 2.208.024.012-.192.12-.972.156-1.164h-.432c-.552 0-.624-.18-.6-.588.024-.408.624-4.296.744-4.764.132-.468.336-.648.768-.648h.432c.012-.192.12-.948.156-1.128-.192 0-1.404.024-2.196.024-.792 0-2.208-.024-2.208-.024-.024.18-.12.936-.168 1.128h.492c.432 0 .552.18.516.648-.024.468-.624 4.296-.756 4.764-.12.48-.192.588-.708.588h-.444c-.024.18-.12.972-.168 1.164zM60.37.48c-2.328 0-3.972 1.356-4.44 4.368-.456 3.156.888 4.452 3.492 4.452 2.46 0 3.636-1.188 4.032-3.528-.048.012-.48.024-.756.024-.264 0-.684-.012-.732-.024-.264 1.44-.924 2.232-2.268 2.232-.984 0-1.728-.528-1.332-3.156.36-2.376 1.056-3.144 2.268-3.144 1.236 0 1.656.804 1.464 2.076.06 0 .552-.024.72-.024.18 0 .612.024.672.024.072-.96.324-2.376.648-3.12-.204.024-.78.024-.984 0-.084.48-.372.564-.768.348-.552-.3-1.188-.528-2.016-.528zm10.368 1.488c.648 0 .852.42.78 1.116l-.108.936c.3-.024.852-.024 1.152 0 .096-.816.408-2.508.564-3.324-.432.012-.948.06-2.208.06h-3.72c-1.236 0-1.74-.036-2.22-.06-.072.816-.3 2.508-.444 3.324.336-.024.864-.024 1.164 0l.204-.936c.156-.732.468-1.116 1.116-1.116h.744c-.192 1.488-.612 4.428-.804 5.244-.108.456-.324.648-.864.648h-.468c-.012.18-.12.972-.168 1.164 0 0 1.5-.024 2.34-.024.84 0 2.328.024 2.328.024.024-.192.12-.984.168-1.164h-.48c-.54 0-.684-.252-.648-.648.06-.828.54-3.756.792-5.244h.78zm6.156 6.108c-1.272 0-1.644-.828-1.284-3.228.348-2.352 1.044-3.144 2.28-3.144 1.248 0 1.656.708 1.284 3.132-.348 2.316-.96 3.24-2.28 3.24zM76.726 9.3c2.436 0 4.476-1.38 4.932-4.464.432-2.856-.78-4.356-3.6-4.356-2.544 0-4.488 1.356-4.944 4.368-.432 2.928 1.008 4.452 3.612 4.452zm12.672-2.508c0-.852-.252-1.452-1.104-1.68 1.068-.228 2.016-.888 2.148-2.1.168-1.452-.756-2.268-3.096-2.268-.48 0-1.572.012-2.124.012-.468 0-2.172-.036-2.364-.036-.024.252-.108.888-.156 1.14h.492c.444 0 .552.18.516.648-.024.468-.624 4.308-.744 4.764-.144.492-.276.588-.756.588h-.396c-.024.192-.132.972-.18 1.164 0 0 1.392-.024 2.196-.024.804 0 2.244.024 2.244.024.012-.192.132-.984.168-1.164h-.468c-.444 0-.6-.18-.6-.636 0-.18.108-.948.24-1.824h.408c.864 0 1.308.276 1.176 1.62-.132 1.38.144 2.244 1.884 2.244 1.656 0 2.136-1.368 2.04-2.748l-.672.06c.06.732-.084 1.512-.432 1.512-.324 0-.432-.336-.42-1.296zM85.93 2.376c.108-.36.276-.552.72-.552h.276c.936 0 1.284.456 1.152 1.38-.144.996-.636 1.416-1.752 1.416h-.792c.168-1.068.348-2.1.396-2.244z"/>
</svg>
							</span>
					</Link>
				</Box>
			</Flex>
		</div>
	)
};

const Footer = ({off}) => {
	const classes = classNames("footer", style.footer);
	return (
		<div className={classes}>
			<Flex justify='flex-start' align='center' wrap={false}>
				<Box>
					<K/>
				</Box>
				<Box flexAuto/>
				<Box>
					<IconButtons off={off}/>
				</Box>
			</Flex>
		</div>
	)
};

const Sidebar = withActive(({active, on, off, toggle}) => {
	const classes       = classNames("sidebar", style.root, {
		[style.active]: active,
	});
	const buttonClasses = classNames(style.mobileButton, {
		[style.buttonActive]: !active,
	});
	const bodyClasses   = classNames({
		'noverflow': active,
	});
	const handleToggle  = () => {
		toggle();
		ReactGA.event({
			category: 'Navigation',
			action:   'Menu Toggled'
		});
	};
	return (
		<div className={classes}>
			<Flex flexColumn wrap={false} flex className={style.inner}>
				<Box px={2}>
					<Header off={off}/>
				</Box>
				<Box flexAuto flex>
					<Menu off={off}/>
				</Box>
				<Box px={2}>
					<Footer off={off}/>
				</Box>
			</Flex>
			<Headroom disableInlineStyles>
				<div className={style.menuToggle}>
					<button onClick={() => handleToggle()} className={buttonClasses}>{!active ? 'menu' : 'close'}</button>
				</div>
			</Headroom>
			<BodyClass className={bodyClasses}/>
		</div>
	);
});

export default Sidebar;
